@page
@using IMDb.Views
@model QueryModel

@functions {

    public class personPlaysInGenre
    {
    }

}

@{
    ViewData["Title"] = "Query";
}


<div class="container-fluid text-center">
    <div class="row">


        <h1 class="display-4 p-2">Query page!</h1>
        <p>Here you'll find a tool to query the database with a limited set of parameters</p>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script>
    
    var subjectObject = {
      "Actor": {
        "Movie": ["Action", "Thriller", "Adventure", "Horror", ],
        "Serie": ["Borders", "Margins", "Backgrounds", "Float"],
        "Both": ["Variables", "Operators", "Functions", "Conditions"]    
      },
      "Movie": {
        "Genre": ["Variables", "Strings", "Arrays"],
        
      },
      "Serie": {
          }
    }
    window.onload = function() {
      var subjectSel = document.getElementById("subject");
      var topicSel = document.getElementById("topic");
      var chapterSel = document.getElementById("chapter");
      for (var x in subjectObject) {
        subjectSel.options[subjectSel.options.length] = new Option(x, x);
      }
      subjectSel.onchange = function() {
    //empty Chapters- and Topics- dropdowns
    chapterSel.length = 1;
     topicSel.length = 1;
        //display correct values
        for (var y in subjectObject[this.value]) {
          topicSel.options[topicSel.options.length] = new Option(y, y);
        }
      }
      topicSel.onchange = function() {
    //empty Chapters dropdown
    chapterSel.length = 1;
        //display correct values
        var z = subjectObject[subjectSel.value][this.value];
        for (var i = 0; i < z.length; i++) {
          chapterSel.options[chapterSel.options.length] = new Option(z[i], z[i]);
        }
      }
    }
    </script>
        <div class="form-group">
            <form method="post">
                <div class="row">
                    <div class="col">
                        <div class="form-floating">
                            <select asp-for="selectedActorOrWriterOrDirector" class="form-select" id="floatingSelectOne">
                                <option value="Actor">Actor</option>
                                <option value="Director">Director</option>
                                <option value="Writer">Writer</option>
                            </select>
                            <label for="floatingSelectOne">Select actor, director or writer.</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-floating">
                            <select asp-for="selectedGenre" class="form-select" id="floatingSelect">
                                <option selected>Open this select menu</option>
                                @foreach (var gp in Model.Genres)
                                {
                                    <option value="@gp.genreName"> @gp.genreName </option>
                                }
                            </select>
                            <label for="floatingSelect">Select Genre</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-floating">
                            <input type="number" asp-for="selectedSuccesfulTitles" class="form-control" id="floatingSelectTwo">
                            <label for="floatingSelectTwo">Select how many succesful titles</label>
                        </div>
                    </div>
                    <div class="col">
                        <button type="submit" asp-page-handler="Table" class="btn btn-primary">Submit</button>
                    </div>
                </div>
            </form>
        </div>
        <table class="table">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Name</th>
                <th scope="col">Average rating</th>
                <th scope="col">Succesful titles</th>

            </tr>
            </thead>

            @foreach (var actor in Model.PersonCombosTwos)
            {
                <tbody>
                <tr>
                    <th scope="row"></th>
                    <td>@actor.personName</td>
                    <td>@actor.movie_average_rating</td>
                    <td>@actor.played_in_succesful_titles</td>
                </tr>
                </tbody>
            }
            @foreach (var director in Model.DirectorComboTwos)
            {
                <tbody>
                <tr>
                    <th scope="row"></th>
                    <td>@director.personName</td>
                    <td>@director.movie_average_rating</td>
                    <td>@director.played_in_succesful_titles</td>
                </tr>
                </tbody>
            }
            @foreach (var writer in Model.WriterComboTwos)
            {
                <tbody>
                <tr>
                    <th scope="row"></th>
                    <td>@writer.personName</td>
                    <td>@writer.movie_average_rating</td>
                    <td>@writer.played_in_succesful_titles</td>
                </tr>
                </tbody>
            }

        </table>


        @* <form method="post" name="form1" id="form1"> *@
        @*     Subjects: *@
        @*     <select name="subject" id="subject"> *@
        @*         <option value="" selected="selected">Select subject</option> *@
        @*     </select> *@
        @*     Types: *@
        @*     <select name="topic" id="topic"> *@
        @*         <option value="" selected="selected">Please select subject first</option> *@
        @*     </select> *@
        @*     Genres: *@
        @*     <select name="chapter" id="chapter"> *@
        @*         <option value="" selected="selected">Please select topic first</option> *@
        @*     </select> *@
        @*     <input type="submit" value="Submit"> *@
        @* </form> *@
    </div>
</div>

@*here i include chart.js for graphs in our application*@
@*<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<script>
    var xValues = [2016, 2017, 2018, 2019, 2020, 2021, 2022];

    new Chart(document.getElementById("bar-chart"), {
        type: 'bar',
        data: {
            labels: ["horror", "family", "action", "comedy", "drama"],
            datasets: [
                {
                    label: "movies in db of this category",
                    backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850"],
                    data: [2478, 5267, 734, 784, 433]
                }
            ]
        },
        options: {
            maintainAspectRatio: false,
            legend: { display: false },
            title: {
                display: true,
                text: 'number of movies released per category per year for 6 years'
            }
        }
    });



    new Chart(document.getElementById("line-chart"), {
        type: "line",
        data: {
            labels: xValues,
            datasets: [{
                data: [860, 1140, 1060, 1060, 1070, 1110, 1330],
                borderColor: "red",
                fill: false,
                label: 'horror'
            }, {
                data: [1600, 1700, 1700, 1900, 2000, 2700, 4000],
                borderColor: "green",
                fill: false,
                label: 'family'
            }, {
                data: [300, 700, 2000, 5000, 6000, 4000, 2000],
                borderColor: "blue",
                fill: false
                ,label: 'action'
            }]
        },
        options: {
            maintainAspectRatio: false,
            legend: { display: true },
            title: {
                display: true,
                text: 'number of views per category per year'
            }
        }
    });</script>*@